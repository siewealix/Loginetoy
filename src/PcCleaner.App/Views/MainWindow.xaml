<Window x:Class="PcCleaner.App.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="PcCleaner" Height="750" Width="1100"
        WindowStartupLocation="CenterScreen">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
            <Button Content="Scanner" Command="{Binding ScanCommand}" />
            <Button Content="Nettoyer" Command="{Binding CleanCommand}" />
            <Button Content="Annuler" Command="{Binding CancelCommand}" />
            <CheckBox Content="Dry-run (simulation)" IsChecked="{Binding IsDryRun}" Margin="12,0,0,0" VerticalAlignment="Center" />
        </StackPanel>

        <TabControl Grid.Row="1" Margin="0,12,0,12">
            <TabItem Header="Analyse & Nettoyage">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,16,0">
                        <TextBlock FontSize="16" FontWeight="Bold" Text="Catégories" Margin="0,0,0,8" />
                        <ItemsControl ItemsSource="{Binding Categories}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,8">
                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsSelected}" />
                                        <TextBlock Text="{Binding Description}" FontSize="11" Foreground="Gray" />
                                        <TextBlock Text="Admin requis" FontSize="11" Foreground="DarkRed" Visibility="{Binding RequiresAdmin, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <TextBlock Text="Total estimé" FontWeight="Bold" Margin="0,16,0,4" />
                        <TextBlock Text="{Binding TotalBytesDisplay}" />
                    </StackPanel>

                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock Text="Éléments détectés" FontSize="16" FontWeight="Bold" Margin="0,0,0,8" />

                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding Items}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  SelectionMode="Extended">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Sélection" Binding="{Binding IsSelected}" Width="80" />
                                <DataGridTextColumn Header="Chemin" Binding="{Binding Path}" Width="*" />
                                <DataGridTextColumn Header="Catégorie" Binding="{Binding Category}" Width="140" />
                                <DataGridTextColumn Header="Raison" Binding="{Binding Reason}" Width="180" />
                                <DataGridTextColumn Header="Taille (octets)" Binding="{Binding SizeBytes}" Width="120" />
                                <DataGridTextColumn Header="Sécurité" Binding="{Binding SafeLevel}" Width="100" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </TabItem>
            <TabItem Header="Rapport">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Text="Résumé" FontSize="16" FontWeight="Bold" />
                    <TextBlock Grid.Row="1" Text="{Binding LastRunSummary}" Margin="0,4,0,12" />

                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Erreurs" FontWeight="Bold" Margin="0,0,0,8" />
                            <ListView ItemsSource="{Binding Errors}">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Chemin" DisplayMemberBinding="{Binding Path}" Width="260" />
                                        <GridViewColumn Header="Message" DisplayMemberBinding="{Binding Message}" Width="260" />
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="16,0,0,0">
                            <TextBlock Text="Audit" FontWeight="Bold" Margin="0,0,0,8" />
                            <ListBox ItemsSource="{Binding AuditEntries}" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>

        <StatusBar Grid.Row="2">
            <StatusBarItem Content="{Binding StatusMessage}" />
            <StatusBarItem Content="{Binding IsScanning, StringFormat=Scan: {0}}" />
            <StatusBarItem Content="{Binding IsCleaning, StringFormat=Nettoyage: {0}}" />
        </StatusBar>
    </Grid>
</Window>
